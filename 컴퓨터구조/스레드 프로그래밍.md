# 스레드 프로그래밍

**요약**
- 프로세스는 초기에 하나의 시작 스레드를 가진다.
- 스레드는 다른 스레드를 만들 수 있다.
- 모든 스레드는 자신 고유의 스택 영역을 가지며, Data, Heap, Code 영역은 공유한다.
- 스레드는 CPU에서 하드웨어적으로 관리된다. (x86)

|영역|프로세스|스레드|
|:---:|:---:|:---:|
|Code|독립|공유|
|Data|독립|공유|
|Heap|독립|공유|
|Stack|독립|독립|

**스레드의 특징**
- 스레드마다 생성 시 스택 영역은 별도로 생성된다. 그런데 코드, 데이터, 힙은 공유한다.
  1. 부모스레드가 실행하는 프로그램과 자식 스레드가 실행하는 프로그램은 같은 프로그램이다.
  2. 코드를 복사해서 쓰는 것이 아닌, 한 장소에 있는 것을 자식, 부모가 같이 사용하는 것이다.
  3. 그렇기 때문에 자식 스레드의 코드, 데이터, 힙은 실체가 없고 모두가 공유해서 사용한다.
- 스레드는 CPU에서 하드웨어적으로 관리된다. CPU안에 자료구조가 있다. (실은 CPU 안이 아닌 메모리 안에)
- 부모 스레드가 실행하고 데이터에 전역 변수 내용을 고친 뒤, 자식이 데이터를 읽으면 바뀐 값이 읽힌다.
  1. 복사한 것이 아닌, 한 장소에 있는 것을 함께 쓰는 것이기 때문에 굳이 알려주지 않아도 된다.
  2. 하지만, 스택 영역은 바뀌지 않는다. (지역변수의 수정은 반영되지 않는다.)
- 지역변수는 서로 볼 수 없고 수정할 수 없다. 그러나 전역변수는 공유할 수 있다.
  1. 데이터 영역에 특별한 키워드를 사용하면 독립적으로 사용할 수는 있다.
  2. 하지만, 스택은 공유 그런 것이 없는데 따로 사용하면 관계가 틀어지고 프로그램 사이에는 버그가 나기 쉽기 때문에 하지 않는다.

**스레드의 장단점**
- 장점
  1. 생성 오버헤드가 적다.   
    스레드를 만들 때 시스템 콜을 해야 하는 데 걸리는 시간이 프로세스보다 적다.   
    오버헤드는 자원(메모리), i/o자원을 할당 해주어야 한다.   
    스레드를 만들 때 시스템 콜을 할 때 공유하기 때문에 새로운 자원 할당 즉, 메모리를 줄 필요가 없다.   
  2. Context Switch Overhead가 적다. (Virtual memory(TBL교체 오버헤드))    
    가상 메모리이기 때문에 맵핑을 바꿔야 하는데 스레드는 가상 메모리 맵핑을 그대로 공유하기 때문에 교체할 필요가 없다.
  3. 스레드 간의 통신이 간단하다.
- 단점
  1. 하나의 스레드에서 발생한 문제가 전체 프로세스를 멈추게 한다.
  2. 디버깅이 어렵다.
    프로그램은 하나인데, 여러 군데가 동시에 실행되고 있기 때문에 어렵다.
